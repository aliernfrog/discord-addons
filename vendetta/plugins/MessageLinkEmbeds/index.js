(function(v,i,y,$){"use strict";const C=i.findByName("RowManager"),T=i.findByProps("getAPIBaseURL"),I=i.findByStoreName("ThemeStore"),{getChannel:x}=i.findByStoreName("ChannelStore"),{getGuild:E}=i.findByStoreName("GuildStore"),{resolveSemanticColor:N}=i.findByProps("colors","meta").meta,P=/(?<!<)https?:\/\/(?:\w+\.)?discord(?:app)?\.com\/channels\/(\d{17,20}|@me)\/(\d{17,20})\/(\d{17,20})/g,d=new Map;let u,m;const b=vendetta.patcher.after("generate",C.prototype,function(r,n){let[t]=r;var s,c;if(t.rowType!==1)return;const h=t==null||(s=t.message)===null||s===void 0?void 0:s.content;if(!h)return;const G=(c=h.match)===null||c===void 0?void 0:c.call(h,P),O=G?.map(function(e){const o=e.split("/").slice(-3);return{guildId:o[0]=="@me"?null:o[0],channelId:o[1],messageId:o[2],rawURL:e}});n.message.embeds??=[],O?.forEach(function(e){var o,g,p,f;if(!d.has(e.messageId))return D(e.channelId,e.messageId).then(function(){return M(t.message)});const a=d.get(e.messageId);if(!a||n.message.renderContentOnly!=!1)return;const R=`https://cdn.discordapp.com/avatars/${(o=a.author)===null||o===void 0?void 0:o.id}/${(g=a.author)===null||g===void 0?void 0:g.avatar}.png`,q=new Date(a.timestamp).toLocaleString([],{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}),l=e.guildId?E(e.guildId):null,w=l?.name,L=l?`https://cdn.discordapp.com/icons/${l.id}/${l.icon}.png`:null,F=x(e.channelId),S=F?.name,U=`${S?"#"+S:""}${w?"  \u2022  "+w:""}`,B=U.length?U:null;n.message.embeds.push({type:"rich",author:{name:`${((p=a.author)===null||p===void 0?void 0:p.global_name)??((f=a.author)===null||f===void 0?void 0:f.username)}  \u2022  ${q}`,url:e.rawURL,iconURL:R,iconProxyURL:R},rawDescription:a.content,description:[{content:a.content,type:"text"}],fields:[],footer:{text:B,iconURL:L,iconProxyURL:L,content:B},bodyTextColor:_()})})}),A=function(){return b()};async function D(r,n){var t;if(d.has(n))return;d.set(n,null);const s=await T.get({url:`/channels/${r}/messages`,query:{limit:1,around:n},retries:2}).catch(function(){return null}),c=s==null||(t=s.body)===null||t===void 0?void 0:t[0];return d.set(n,c),c}function M(r){y.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...r,content:r.content+"\u200B"},log_edit:!1})}function _(){return m==I.theme&&u||(m=I.theme,u=y.ReactNative.processColor(N(m,$.semanticColors.TEXT_NORMAL))),u}return v.onUnload=A,v})({},vendetta.metro,vendetta.metro.common,vendetta.ui);
